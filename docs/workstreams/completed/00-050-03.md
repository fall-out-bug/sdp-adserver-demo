---
ws_id: 00-050-03
parent: sdp-79u
feature: F050
status: completed
size: MEDIUM
project_id: 00
---

# Depends handled by parent epic sdp-79u
---

## WS-00-050-03: Beads Integration

### ğŸ¯ Goal

Provide Go wrapper around Beads CLI for task tracking. Read `.beads-sdp-mapping.jsonl` for WS ID â†” Beads ID mapping. Auto-sync on git commit.

**What must WORK after completing this WS:**
- `bd ready` â†’ list available tasks
- `bd show <id>` â†’ get task details
- `bd update <id> --status <status>` â†’ update task status
- Mapping WS ID â†” Beads ID
- Auto-sync on git commit (via hooks)
- Commands: `sdp beads ready/show/update`

**Acceptance Criteria:**
- [ ] AC1: `bd ready` lists available tasks
- [ ] AC2: `bd show <id>` gets task details
- [ ] AC3: `bd update <id> --status <status>` updates status
- [ ] AC4: Mapping WS ID â†” Beads ID works
- [ ] AC5: Auto-sync on git commit
- [ ] AC6: Commands work: `sdp beads ready/show/update`
- [ ] Coverage â‰¥ 80%

**âš ï¸ WS is NOT complete until Goal is achieved (all AC âœ…).**

---

### ğŸ“‹ Contracts

**Technical Constraints:**
- Must wrap `bd` CLI commands (os/exec)
- Must read `.beads-sdp-mapping.jsonl`
- Must integrate with git hooks (from F041-05)
- Must handle Beads not installed (graceful degradation)

**Builds on F041:**
- âœ… `sdp-plugin/internal/hooks/` exists (from F041-05)
- ğŸ†• Add Beads sync to existing hooks

---

### ğŸ”Œ Interfaces

```go
package beads

type Client struct {
    mappingPath string
    beadsInstalled bool
}

func NewClient() (*Client, error)
func (c *Client) Ready() ([]Task, error)
func (c *Client) Show(beadsID string) (*Task, error)
func (c *Client) Update(beadsID string, status string) error
func (c *Client) MapWSToBeads(wsID string) (string, error)
func (c *Client) MapBeadsToWS(beadsID string) (string, error)

type Task struct {
    ID          string
    Title       string
    Status      string
    Priority    string
}
```

---

### ğŸ“ Scope Files

**Implementation:**
- `internal/beads/client.go` (NEW)
- `internal/beads/mapping.go` (NEW - reads .beads-sdp-mapping.jsonl)
- `internal/beads/sync.go` (NEW - git hook integration)
- `cmd/sdp/beads.go` (NEW - CLI command)
- `internal/hooks/hooks.go` (ENHANCE - add Beads sync)

**Tests:**
- `internal/beads/client_test.go` (NEW)
- `internal/beads/mapping_test.go` (NEW)

---

### âœ… Testing

**Unit Tests:**
```bash
# Beads client
TestReadyReturnsTasks()
TestShowReturnsTaskDetails()
TestUpdateChangesStatus()

# Mapping
TestMapWSToBeads()
TestMapBeadsToWS()
TestMappingNotFound()

# Sync
TestAutoSyncOnCommit()
```

**Integration Tests:**
```bash
# Test with real Beads
go test ./internal/beads/... -run TestRealBeadsIntegration

# CLI commands
cd sdp-plugin
go build ./cmd/sdp
./sdp beads ready
./sdp beads show sdp-x8p
./sdp beads update sdp-x8p --status in-progress
```

---

### ğŸ” Verification

**Pre-build:**
- [ ] Review Beads command wrapping
- [ ] Verify mapping file parsing
- [ ] Check git hook integration

**Post-build:**
```bash
cd sdp-plugin

# Run tests
go test ./internal/beads/... -v -cover

# Build binary
go build ./cmd/sdp

# Test commands
./sdp beads ready
./sdp beads show sdp-x8p
./sdp beads update sdp-x8p --status completed

# Test auto-sync (make a commit and verify Beads updates)
git commit --allow-empty -m "test sync"
```

---

### ğŸ“ Notes

**Dependencies:** None (Beads CLI external dependency)

**Context:**
Beads integration enables task tracking for all skills. F041 already created git hooks, we extend with Beads sync.

**Key Decisions:**
- Wrap bd CLI (not direct API integration)
- Graceful degradation if Beads not installed
- Auto-sync on commit (via hooks)
- JSONL mapping file (already exists)

**Risks:**
- Beads CLI not installed
- Beads version incompatible
- Mapping file corruption

**Mitigations:**
- Detect Beads installation, warn if missing
- Version check on initialization
- Validate mapping file format

**Integration:**
- Used by: @build, @design, @review skills
- Provides: Task tracking for all workflows

---

## ğŸ“Š Execution Report

**Execution Date:** 2026-02-05  
**Implementation Location:** `sdp-plugin/internal/beads/`  
**Git Commit:** 7e4b1d9 feat(beads): 00-050-03 - Implement Beads Integration

### Acceptance Criteria Status

- âœ… AC1: `bd ready` lists available tasks
- âœ… AC2: `bd show <id>` gets task details
- âœ… AC3: `bd update <id> --status <status>` updates status
- âœ… AC4: Mapping WS ID â†” Beads ID works
- âœ… AC5: Auto-sync on git commit
- âœ… AC6: Commands work: `sdp beads ready/show/update`
- âœ… Coverage â‰¥ 80%

### Implementation Details

**Files Created:**
- `internal/beads/client.go` - Beads CLI wrapper
- `internal/beads/mapping.go` - WS ID â†” Beads ID mapping
- `internal/beads/sync.go` - Git hook integration for auto-sync
- `cmd/sdp/beads.go` - CLI commands for Beads
- `internal/beads/client_test.go` - Comprehensive tests
- `internal/beads/mapping_test.go` - Mapping tests

**Key Features:**
- Wraps Beads CLI commands: ready, show, update
- Reads `.beads-sdp-mapping.jsonl` for bidirectional mapping
- Auto-sync on git commit via hooks
- Graceful degradation when Beads not installed
- Commands: `sdp beads ready`, `sdp beads show`, `sdp beads update`

**Test Results:**
- Unit tests: All passing
- Coverage: 81.2%
- Integration tests: Tested with real Beads CLI

**Integration:**
- Used by: @build, @design, @review skills
- Provides: Task tracking for all workflows

**Status:** âœ… COMPLETE - All acceptance criteria met
