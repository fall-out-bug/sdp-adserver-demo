---
ws_id: 00-050-01
parent: sdp-79u
feature: F050
status: completed
size: MEDIUM
project_id: 00
---

# Depends handled by parent epic sdp-79u
---

## WS-00-050-01: Workstream Parser

### ğŸ¯ Goal

Parse workstream markdown files with YAML frontmatter into Go structs. Builds on F041 foundation (sdp-plugin/ already exists).

**What must WORK after completing this WS:**
- Parse YAML frontmatter (--- delimited sections)
- Validate workstream ID format (PP-FFF-SS regex)
- Extract: goal, acceptance criteria, scope files
- Return helpful error messages for invalid YAML
- Commands: `sdp parse <ws-id>`, `sdp parse --validate <ws.md>`

**Acceptance Criteria:**
- [ ] AC1: Parse valid WS markdown â†’ Go struct
- [ ] AC2: Validate WS ID regex: `^\d{2}-\d{3}-\d{2}$`
- [ ] AC3: Extract all frontmatter fields (goal, AC, scope)
- [ ] AC4: Return helpful errors for malformed YAML
- [ ] AC5: Unit tests for edge cases (empty files, missing fields)
- [ ] AC6: Command `sdp parse <ws-id>` displays parsed workstream
- [ ] AC7: Command `sdp parse --validate <ws.md>` validates file
- [ ] Coverage â‰¥ 80%

**âš ï¸ WS is NOT complete until Goal is achieved (all AC âœ…).**

---

### ğŸ“‹ Contracts

**Technical Constraints:**
- Must use `gopkg.in/yaml.v3` for YAML parsing (already in sdp-plugin/go.mod)
- Must use `bytes.SplitN` for frontmatter extraction
- Must return detailed validation errors with field name
- Must use regex for WS ID validation

**Builds on F041:**
- âœ… `sdp-plugin/go.mod` exists (from F041-05)
- âœ… `sdp-plugin/cmd/sdp/main.go` exists (from F041-05)
- âœ… `sdp-plugin/cmd/sdp/` directory exists (from F041-05)
- ğŸ†• Add `internal/parser/` package

---

### ğŸ”Œ Interfaces

```go
// Public API
package parser

func ParseWorkstream(wsPath string) (*Workstream, error)
func (ws *Workstream) Validate() error
func ValidateFile(wsPath string) ([]ValidationIssue, error)

type Workstream struct {
    ID             string
    Feature        string
    Status         string
    Goal           string
    Acceptance     []string
    Scope          Scope
}

type ValidationIssue struct {
    Field    string
    Message  string
    Severity string // ERROR, WARNING
}
```

---

### ğŸ“ Scope Files

**Implementation:**
- `internal/parser/workstream.go` (NEW)
- `internal/parser/validator.go` (NEW)
- `internal/parser/schema.go` (NEW)
- `cmd/sdp/parse.go` (NEW - CLI command)

**Tests:**
- `internal/parser/workstream_test.go` (NEW)
- `internal/parser/validator_test.go` (NEW)

**Existing (from F041):**
- `go.mod` (âœ… exists)
- `cmd/sdp/main.go` (âœ… exists)
- `Makefile` (âœ… exists)

---

### âœ… Testing

**Unit Tests:**
```bash
# Test valid workstream parsing
TestParseValidWorkstream()

# Test invalid WS ID format
TestValidateInvalidWSID()

# Test missing required fields
TestParseMissingRequiredFields()

# Test YAML edge cases
TestParseEmptyFile()
TestParseMalformedYAML()
TestParseMissingFrontmatter()
```

**Integration Tests:**
```bash
# Parse real workstream from backlog
go test ./internal/parser/... -run TestParseRealWorkstream

# CLI command tests
go build ./cmd/sdp
./sdp parse 00-050-01
./sdp parse --validate docs/workstreams/backlog/00-050-01.md
```

---

### ğŸ” Verification

**Pre-build:**
- [ ] Review parser design matches workstream format
- [ ] Verify gopkg.in/yaml.v3 dependency in go.mod (from F041)
- [ ] Check regex for WS ID validation

**Post-build:**
```bash
# Run tests
cd sdp-plugin
go test ./internal/parser/... -v -cover

# Build binary
go build ./cmd/sdp
./sdp parse 00-050-01

# Check output (should display parsed workstream)
./sdp parse --validate docs/workstreams/backlog/00-050-01.md
```

---

### ğŸ“ Notes

**Dependencies:** None (builds on F041 foundation)

**Context:**
This workstream adds parser capability to existing sdp-plugin/ from F041. F041 already created Go module, basic CLI, and build system. We extend with new package, not duplicate existing work.

**Key Decisions:**
- Add `internal/parser/` package to existing sdp-plugin/
- Reuse go.mod, cmd/sdp/main.go from F041
- Parse frontmatter for drift detector integration
- Validation for pre-build checks

**Risks:**
- YAML parsing edge cases (empty files, malformed YAML)
- Regex performance (compile once, reuse)
- Workstream format variations

**Mitigations:**
- Comprehensive test coverage for edge cases
- Helpful error messages with line numbers
- Test with real workstreams from backlog

**Integration:**
- Used by: Drift Detector (00-050-09), Orchestrator (00-050-11)
- Provides: Structured workstream data for other packages

---

## ğŸ“Š Execution Report

**Execution Date:** 2026-02-05  
**Implementation Location:** `sdp-plugin/internal/parser/`  
**Git Commit:** c5b4cfa feat(parser): 00-050-01 - Implement Workstream Parser

### Acceptance Criteria Status

- âœ… AC1: Parse valid WS markdown â†’ Go struct
- âœ… AC2: Validate WS ID regex: `^\d{2}-\d{3}-\d{2}$`
- âœ… AC3: Extract all frontmatter fields (goal, AC, scope)
- âœ… AC4: Return helpful errors for malformed YAML
- âœ… AC5: Unit tests for edge cases (empty files, missing fields)
- âœ… AC6: Command `sdp parse <ws-id>` displays parsed workstream
- âœ… AC7: Command `sdp parse --validate <ws.md>` validates file
- âœ… Coverage â‰¥ 80%

### Implementation Details

**Files Created:**
- `internal/parser/workstream.go` - Workstream struct and parsing logic
- `internal/parser/validator.go` - WS ID validation and field checks
- `internal/parser/frontmatter.go` - YAML frontmatter extraction
- `internal/parser/parser.go` - Main parser interface
- `cmd/sdp/parse.go` - CLI command for parsing
- `internal/parser/workstream_test.go` - Comprehensive unit tests
- `internal/parser/validator_test.go` - Validation tests

**Key Features:**
- Parses YAML frontmatter with `---` delimiters
- Validates PP-FFF-SS format with regex
- Extracts all fields: goal, acceptance criteria, scope files
- Returns detailed error messages with line numbers
- Supports `sdp parse` and `sdp parse --validate` commands

**Test Results:**
- Unit tests: All passing
- Coverage: 85.3%
- Integration tests: Validated against real workstreams

**Integration:**
- Used by: Drift Detector (00-050-09), Orchestrator (00-050-11)
- Provides: Structured workstream data for other packages

**Status:** âœ… COMPLETE - All acceptance criteria met
